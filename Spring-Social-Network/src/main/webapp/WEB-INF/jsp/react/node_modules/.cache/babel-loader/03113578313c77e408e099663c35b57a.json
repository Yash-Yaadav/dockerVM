{"ast":null,"code":"import _regeneratorRuntime from\"/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faComments}from'@fortawesome/free-solid-svg-icons';import{faGlassCheers}from'@fortawesome/free-solid-svg-icons';import{CurrentUserContext}from\"./Navbar\";import Comment from'./Comment';import{useHistory}from\"react-router-dom\";import Axios from'axios';import TimeAgo from'react-timeago';var style={objectFit:'cover',borderRadius:'50%',width:'50px',height:'50px'};function Post(props){var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),postImageUrl=_React$useState2[0],setPostImageUrl=_React$useState2[1];var _React$useState3=React.useState(new Date()),_React$useState4=_slicedToArray(_React$useState3,2),dateTime=_React$useState4[0],setDateTime=_React$useState4[1];var _React$useState5=React.useState(0),_React$useState6=_slicedToArray(_React$useState5,2),cheers=_React$useState6[0],setCheers=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),editable=_React$useState8[0],setEditable=_React$useState8[1];var _React$useState9=React.useState(props.post.text),_React$useState10=_slicedToArray(_React$useState9,2),text=_React$useState10[0],setText=_React$useState10[1];var history=useHistory();var currentUser=React.useContext(CurrentUserContext);function insertComment(evt){evt.preventDefault();fetch(\"/post/insertComment\",{method:'POST',credentials:\"include\",headers:{'input':evt.target.input.value,'postId':props.post.postId}}).then(function(response){return response.json();}).then(function(data){return props.value.setValue(!props.value.value);});evt.target.input.value=\"\";}function updatePost(_x){return _updatePost.apply(this,arguments);}function _updatePost(){_updatePost=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(evt){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!editable){_context.next=10;break;}_context.prev=1;_context.next=4;return Axios.post('/post/updatePost',{'text':text},{withCredentials:true,headers:{'Content-Type':'application/json',postId:props.post.postId}});case 4:_context.next=10;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);console.log(_context.t0);setText(props.post.text);case 10:setEditable(!editable);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));return _updatePost.apply(this,arguments);}function cheer(){fetch(\"/post/cheers\",{method:\"POST\",credentials:\"include\",headers:{postId:props.post.postId}}).then(function(response){return response.json();}).then(function(data){setCheers(data.filter(function(cheer){return cheer.active===true;}).length);});}function deletePost(){fetch(\"/post/removePost\",{method:\"POST\",credentials:\"include\",headers:{postId:props.post.postId}}).then(function(data){history.push(\"/profile\");history.push(\"/\");});}function viewProfile(){if(props.post.user.userId===currentUser.userId){history.push(\"/profile\");}else{history.push({pathname:'/ProfileAll',state:{detail:props.post.user.userId}});}}React.useEffect(function(){// Date render\nvar tempDate=new Date(props.post.created);tempDate.setHours(tempDate.getHours()+3,tempDate.getMinutes(),tempDate.getSeconds(),tempDate.getMilliseconds());setDateTime(tempDate);// Cheers render\nsetCheers(props.post.cheers.filter(function(cheer){return cheer.active===true;}).length);// Delete post render\n// if (props.post.user.userId === currentUser.userId) {\n//     console.log(props.post);\n//     document.getElementById(\"deleteButton\" + props.post.postId).style.display = \"block\";\n// }\n// Image render\nif(props.post.imageUrl===\"BLOB\"){document.getElementById(\"postImage\"+props.post.postId).style.display=\"block\";setPostImageUrl(\"/post/downloadPostImage/\"+props.post.postId);}else if(props.post.imageUrl!==\"\"&&props.post.imageUrl!==null){document.getElementById(\"postImage\"+props.post.postId).style.display=\"block\";setPostImageUrl(props.post.imageUrl);}// else if (!(props.post.postImage === null || props.post.postImage === undefined)) {\n//     document.getElementById(\"postImage\"+props.post.postId).style.display = \"block\";\n//     setPostImageUrl(\"/post/downloadPostImage/\" + props.post.postId);\n// }\n},[]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"card p-0 my-3\"},\" \",/*#__PURE__*/React.createElement(\"div\",{className:\"card-body d-flex flex-row p-3\"},/*#__PURE__*/React.createElement(\"img\",{style:style,src:\"/api/profile/searchUsers/\"+props.post.user.userId,className:\"avatar rounded-circle mx-3\",alt:\"Profile picture\",onClick:viewProfile}),/*#__PURE__*/React.createElement(\"div\",{className:\"w-100\",onClick:viewProfile},/*#__PURE__*/React.createElement(\"h5\",{className:\"card-title mb-0\",style:{cursor:\"pointer\"}},props.post.user.firstName+\" \"+props.post.user.lastName),/*#__PURE__*/React.createElement(\"p\",{className:\"card-text text-secondary\"},/*#__PURE__*/React.createElement(\"small\",null,/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-clock pr-2\"}),/*#__PURE__*/React.createElement(TimeAgo,{date:props.post.created})))),props.post.user.userId===currentUser.userId&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{onClick:updatePost,id:\"updateButton\"+props.post.postId,style:{cursor:\"pointer\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-edit mr-2\"})),/*#__PURE__*/React.createElement(\"div\",{onClick:deletePost,id:\"deleteButton\"+props.post.postId,style:{cursor:\"pointer\"}},/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-trash-alt\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body p-1\"},/*#__PURE__*/React.createElement(\"img\",{src:postImageUrl,alt:\"Couldn't load image from URL\",className:\"img-fluid rounded\",id:\"postImage\"+props.post.postId,style:{display:\"none\",width:\"100%\"}}),/*#__PURE__*/React.createElement(\"blockquote\",{className:\"card-text p-3 m-0\"},!editable&&/*#__PURE__*/React.createElement(\"p\",{className:\"mb-0\"},text),editable&&/*#__PURE__*/React.createElement(\"textarea\",{value:text,rows:\"6\",minLength:\"1\",maxLength:\"250\",className:\"form-control\",onChange:function onChange(evt){setText(evt.target.value);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-xs-12 col-sm-4 col-md-4 m-2\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{className:\"mx-2\",icon:faGlassCheers,onClick:cheer,style:{cursor:\"pointer\"}}),cheers,/*#__PURE__*/React.createElement(FontAwesomeIcon,{className:\"mx-2\",icon:faComments,\"data-toggle\":\"collapse\",\"data-target\":\"#collapseExample\"+props.post.postId,\"aria-expanded\":\"false\",\"aria-controls\":\"collapseExample\",style:{cursor:\"pointer\"}}),props.post.comments.length))),/*#__PURE__*/React.createElement(\"form\",{className:\"mx-2\",onSubmit:insertComment},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",placeholder:\"Enter a comment...\",name:\"input\",minLength:\"1\",maxLength:\"250\"}))),/*#__PURE__*/React.createElement(\"small\",{className:\"ml-2 mt-0 mb-1\",\"data-toggle\":\"collapse\",\"data-target\":\"#collapseExample\"+props.post.postId,\"aria-expanded\":\"false\",\"aria-controls\":\"collapseExample\",style:{cursor:\"pointer\"}},\"Show/Hide Comments\"),/*#__PURE__*/React.createElement(\"div\",{className:\"collapse\",id:\"collapseExample\"+props.post.postId},props.post.comments.sort(function(a,b){return new Date(a.created)-new Date(b.created);}).map(function(comment){return/*#__PURE__*/React.createElement(Comment,{comment:comment,value:props.value,key:comment.commentId});}))));}export default Post;","map":{"version":3,"sources":["/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/src/components/Post.jsx"],"names":["React","FontAwesomeIcon","faComments","faGlassCheers","CurrentUserContext","Comment","useHistory","Axios","TimeAgo","style","objectFit","borderRadius","width","height","Post","props","useState","postImageUrl","setPostImageUrl","Date","dateTime","setDateTime","cheers","setCheers","editable","setEditable","post","text","setText","history","currentUser","useContext","insertComment","evt","preventDefault","fetch","method","credentials","headers","target","input","value","postId","then","response","json","data","setValue","updatePost","withCredentials","console","log","cheer","filter","active","length","deletePost","push","viewProfile","user","userId","pathname","state","detail","useEffect","tempDate","created","setHours","getHours","getMinutes","getSeconds","getMilliseconds","imageUrl","document","getElementById","display","cursor","firstName","lastName","comments","sort","a","b","map","comment","commentId"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faComments } from '@fortawesome/free-solid-svg-icons';\nimport { faGlassCheers } from '@fortawesome/free-solid-svg-icons';\nimport { CurrentUserContext } from \"./Navbar\";\nimport Comment from './Comment';\nimport {useHistory} from \"react-router-dom\";\nimport Axios from 'axios';\nimport TimeAgo from 'react-timeago';\n\nconst style = {\n    objectFit: 'cover',\n    borderRadius: '50%',\n    width: '50px',\n    height: '50px'\n};\n\nfunction Post(props) {\n\n    const [postImageUrl, setPostImageUrl] = React.useState(\"\");\n    const [dateTime, setDateTime] = React.useState(new Date());\n    const [cheers, setCheers] = React.useState(0);\n    const [editable, setEditable] = React.useState(false);\n    const [text, setText] = React.useState(props.post.text);\n    const history = useHistory();\n\n    const currentUser = React.useContext(CurrentUserContext);\n\n    function insertComment(evt) {\n        evt.preventDefault();\n\n        fetch(\"/post/insertComment\",{\n            method: 'POST',\n            credentials: \"include\",\n            headers: {\n                'input': evt.target.input.value,\n                'postId': props.post.postId\n            }\n        })\n            .then(response => response.json())\n            .then(data => props.value.setValue(!props.value.value));\n\n        evt.target.input.value = \"\";\n    }\n\n    async function updatePost(evt) {\n        if(editable) {\n            try {\n                await Axios.post(\n                    '/post/updatePost',\n                    {\n                        'text': text\n                    },\n                    {\n                        withCredentials: true,\n                        headers: {\n                            'Content-Type': 'application/json',\n                            postId: props.post.postId\n                        }\n                    }\n                );\n            } catch (err) {\n                console.log(err);\n                setText(props.post.text);\n            }\n        }\n        setEditable(!editable);\n    }\n\n    function cheer() {\n        fetch(\"/post/cheers\",{\n            method: \"POST\",\n            credentials: \"include\",\n            headers: {\n                postId: props.post.postId\n            }\n        })\n            .then(response => response.json())\n            .then(data => {\n                setCheers(data.filter(cheer => cheer.active === true).length);\n            })\n    }\n\n    function deletePost() {\n        fetch(\"/post/removePost\",{\n            method: \"POST\",\n            credentials: \"include\",\n            headers: {\n                postId: props.post.postId\n            }\n        })\n            .then((data) => {\n                history.push(\"/profile\");\n                history.push(\"/\");\n            });\n    }\n\n    function viewProfile() {\n        if(props.post.user.userId === currentUser.userId) {\n            history.push(\"/profile\");\n        }\n        else {\n            history.push({\n                pathname: '/ProfileAll',\n                state: {detail: props.post.user.userId}\n            });\n        }\n    }\n\n    React.useEffect(() => {\n        // Date render\n        let tempDate = new Date(props.post.created);\n        tempDate.setHours(tempDate.getHours()+3,tempDate.getMinutes(),tempDate.getSeconds(),tempDate.getMilliseconds());\n        setDateTime(tempDate);\n\n        // Cheers render\n        setCheers(props.post.cheers.filter(cheer => cheer.active === true).length);\n\n        // Delete post render\n        // if (props.post.user.userId === currentUser.userId) {\n        //     console.log(props.post);\n        //     document.getElementById(\"deleteButton\" + props.post.postId).style.display = \"block\";\n        // }\n\n        // Image render\n        if (props.post.imageUrl === \"BLOB\") {\n            document.getElementById(\"postImage\"+props.post.postId).style.display = \"block\";\n            setPostImageUrl(\"/post/downloadPostImage/\" + props.post.postId);\n        }\n        else if (props.post.imageUrl !== \"\" && props.post.imageUrl !== null) {\n            document.getElementById(\"postImage\"+props.post.postId).style.display = \"block\";\n            setPostImageUrl(props.post.imageUrl);\n        }\n        // else if (!(props.post.postImage === null || props.post.postImage === undefined)) {\n        //     document.getElementById(\"postImage\"+props.post.postId).style.display = \"block\";\n        //     setPostImageUrl(\"/post/downloadPostImage/\" + props.post.postId);\n        // }\n    },[]);\n\n    return (\n        <>\n            <div className=\"card p-0 my-3\"> {/*col-md-6 col-xs-12 col-sm-8*/}\n                <div className=\"card-body d-flex flex-row p-3\">\n                    <img style={style} src={\"/api/profile/searchUsers/\" + props.post.user.userId}\n                        className=\"avatar rounded-circle mx-3\"\n                        alt=\"Profile picture\"\n                        onClick={viewProfile}/>\n                    <div className=\"w-100\" onClick={viewProfile}>\n                        <h5 className=\"card-title mb-0\" style={{cursor: \"pointer\"}}>{props.post.user.firstName + \" \" + props.post.user.lastName}</h5>\n                        <p className=\"card-text text-secondary\"><small><i className=\"far fa-clock pr-2\"></i><TimeAgo date={props.post.created}/></small></p>\n                        {/*<p className=\"card-text text-secondary\"><small><i className=\"far fa-clock pr-2\"></i>{dateTime.toLocaleString(\"en-GB\",{timeZone: \"UTC\"})}</small></p>*/}\n                    </div>\n                    {(props.post.user.userId === currentUser.userId) &&\n                        <>\n                            <div onClick={updatePost} id={\"updateButton\" + props.post.postId} style={{cursor: \"pointer\"}}><i className=\"far fa-edit mr-2\"></i></div>\n                            <div onClick={deletePost} id={\"deleteButton\" + props.post.postId} style={{cursor: \"pointer\"}}><i className=\"far fa-trash-alt\"></i></div>\n                        </>\n                    }\n                </div>\n                <div className=\"card-body p-1\">\n                    <img src={postImageUrl} alt=\"Couldn't load image from URL\" className=\"img-fluid rounded\" id={\"postImage\" + props.post.postId} style={{display: \"none\", width: \"100%\"}}/>\n                    <blockquote className=\"card-text p-3 m-0\">\n                        { !editable &&\n                            <p className=\"mb-0\">{text}</p>\n                        }\n                        { editable &&\n                            <textarea value={text} rows=\"6\" minLength=\"1\" maxLength=\"250\" className=\"form-control\" onChange={(evt) => {setText(evt.target.value)}}></textarea>\n                        }\n                    </blockquote>\n                    <div className=\"row\">\n                        <div className=\"col-xs-12 col-sm-4 col-md-4 m-2\">\n                            <FontAwesomeIcon className=\"mx-2\" icon={faGlassCheers} onClick={cheer} style={{cursor: \"pointer\"}}/>{cheers}\n                            {/*{props.post.cheers.length}*/}\n                            <FontAwesomeIcon className=\"mx-2\" icon={faComments} data-toggle=\"collapse\" data-target={\"#collapseExample\" + props.post.postId}\n                                             aria-expanded=\"false\" aria-controls=\"collapseExample\" style={{cursor: \"pointer\"}}/>{props.post.comments.length}\n                        </div>\n                    </div>\n                </div>\n                <form className=\"mx-2\" onSubmit={insertComment}>\n                    <div className=\"form-group\">\n                        <input type=\"text\" className=\"form-control\"\n                               placeholder=\"Enter a comment...\" name=\"input\" minLength=\"1\"  maxLength=\"250\"/>\n                    </div>\n                </form>\n                <small className=\"ml-2 mt-0 mb-1\" data-toggle=\"collapse\" data-target={\"#collapseExample\" + props.post.postId}\n                        aria-expanded=\"false\" aria-controls=\"collapseExample\" style={{cursor: \"pointer\"}}>\n                    Show/Hide Comments\n                </small>\n                <div className=\"collapse\" id={\"collapseExample\" + props.post.postId}>\n                    {props.post.comments.sort((a,b)=>{return new Date(a.created) - new Date(b.created)}).map((comment) => (\n                        <Comment comment={comment} value={props.value} key={comment.commentId}/>\n                    ))}\n                </div>\n            </div>\n        </>\n    );\n}\n\nexport default Post;"]},"metadata":{},"sourceType":"module"}