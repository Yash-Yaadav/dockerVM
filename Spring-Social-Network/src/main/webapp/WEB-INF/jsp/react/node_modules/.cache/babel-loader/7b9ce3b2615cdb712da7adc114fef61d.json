{"ast":null,"code":"import _slicedToArray from\"/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback}from'react';import{useDropzone}from'react-dropzone';import{useHistory}from\"react-router-dom\";import axios from'axios';function PostForm(props){var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),imgUrl=_React$useState2[0],setImgUrl=_React$useState2[1];var _React$useState3=React.useState(\"none\"),_React$useState4=_slicedToArray(_React$useState3,2),buttonDisplay=_React$useState4[0],setButtonDisplay=_React$useState4[1];var regex=new RegExp(\"(http(s?):)([/|.|\\\\w|\\\\s|-])*\\\\.(?:jpg|gif|png)\");var base64regex=new RegExp(/(data:image\\/[^;]+;base64[^\"]+)/g);var _React$useState5=React.useState(\"Drag 'n' drop image, or click to browse \"),_React$useState6=_slicedToArray(_React$useState5,2),fileName=_React$useState6[0],setFileName=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),imageFile=_React$useState8[0],setImageFile=_React$useState8[1];var history=useHistory();var onDrop=useCallback(function(acceptedFiles){var file=acceptedFiles[0];var formData=new FormData();setFileName(file.path+\" \");formData.append(\"file\",file);setImageFile(formData);removeImage();},[]);function onSubmit(evt){evt.preventDefault();if(imageFile===null&&(evt.target.text.value!==\"\"||evt.target.url.value!==\"\")){fetch(\"/post/insertPost\",{method:'POST',credentials:\"include\",headers:{'text':evt.target.text.value,'imageUrl':evt.target.url.value}}).then(function(response){return response.json();}).then(function(data){document.getElementById(\"resetButton\").click();props.closeModal();history.push(\"/profile\");}).then(function(){history.push(\"/\");}).catch(function(error){console.error('Error:',error);});}else if(imageFile!==null){axios.post(\"/post/insertPostWithFile\",imageFile,{headers:{\"Content-Type\":\"multipart/form-data\",'text':evt.target.text.value}}).then(function(){document.getElementById(\"resetButton\").click();props.closeModal();history.push(\"/profile\");}).then(function(){history.push(\"/\");}).catch(function(err){console.log(err);});}else{alert(\"Post cannot be empty\");}}var _useDropzone=useDropzone({onDrop:onDrop}),getRootProps=_useDropzone.getRootProps,getInputProps=_useDropzone.getInputProps,isDragActive=_useDropzone.isDragActive;var removeButtonStyle={display:buttonDisplay};function checkImage(imageSrc){var img=new Image();img.onload=function(){console.log(\"Exists\");};img.onerror=function(){console.log(\"Does not Exist\");};img.src=imageSrc;}function findUrl(evt){if(regex.test(evt.target.value)){setImgUrl(evt.target.value);document.getElementById(\"url\").value=evt.target.value;evt.target.value=\"\";setButtonDisplay(\"inline\");resetForm();}}function removeImage(){setImgUrl(\"\");setButtonDisplay(\"none\");document.getElementById(\"url\").value=\"\";}function resetForm(){setFileName(\"Drag 'n' drop image, or click to browse \");setImageFile(null);}return/*#__PURE__*/React.createElement(\"div\",{className:\"my-2\"},/*#__PURE__*/React.createElement(\"img\",{src:imgUrl,alt:\"\",height:\"120px\",className:\"m-1\"}),/*#__PURE__*/React.createElement(\"button\",{onClick:removeImage,style:removeButtonStyle,className:\"btn btn-white\"},\"x\"),/*#__PURE__*/React.createElement(\"form\",{onSubmit:onSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"form-group\"},/*#__PURE__*/React.createElement(\"textarea\",{className:\"form-control\",id:\"exampleInputEmail1\",\"aria-describedby\":\"freeText\",placeholder:\"What are you thinking?\",onChange:findUrl,name:\"text\",maxLength:\"250\",rows:\"5\"}),/*#__PURE__*/React.createElement(\"small\",{id:\"freeText\",className:\"form-text text-muted\"},\"Only visible to your connections.\"),/*#__PURE__*/React.createElement(\"input\",{type:\"hidden\",id:\"url\",name:\"url\"})),/*#__PURE__*/React.createElement(\"div\",getRootProps(),/*#__PURE__*/React.createElement(\"input\",getInputProps()),isDragActive?/*#__PURE__*/React.createElement(\"p\",null,\"Drop the image here ...\"):/*#__PURE__*/React.createElement(\"p\",null,fileName,/*#__PURE__*/React.createElement(\"i\",{className:\"far fa-file-image\"}))),/*#__PURE__*/React.createElement(\"input\",{type:\"reset\",className:\"btn btn-light mr-2\",value:\"Reset Form\",onClick:resetForm,id:\"resetButton\"}),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn btn-primary\"},\"Post\")));}export default PostForm;","map":{"version":3,"sources":["/root/Spring-Social-Network/src/main/webapp/WEB-INF/jsp/react/src/components/PostForm.jsx"],"names":["React","useCallback","useDropzone","useHistory","axios","PostForm","props","useState","imgUrl","setImgUrl","buttonDisplay","setButtonDisplay","regex","RegExp","base64regex","fileName","setFileName","imageFile","setImageFile","history","onDrop","acceptedFiles","file","formData","FormData","path","append","removeImage","onSubmit","evt","preventDefault","target","text","value","url","fetch","method","credentials","headers","then","response","json","data","document","getElementById","click","closeModal","push","catch","error","console","post","err","log","alert","getRootProps","getInputProps","isDragActive","removeButtonStyle","display","checkImage","imageSrc","img","Image","onload","onerror","src","findUrl","test","resetForm"],"mappings":"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","sourcesContent":["import React, {useCallback} from 'react'\nimport {useDropzone} from 'react-dropzone';\nimport { useHistory } from \"react-router-dom\";\nimport axios from 'axios';\n\nfunction PostForm(props) {\n\n    const [imgUrl, setImgUrl] = React.useState(\"\");\n    const [buttonDisplay, setButtonDisplay] = React.useState(\"none\");\n    const regex = new RegExp(\"(http(s?):)([/|.|\\\\w|\\\\s|-])*\\\\.(?:jpg|gif|png)\");\n    const base64regex = new RegExp(/(data:image\\/[^;]+;base64[^\"]+)/g);\n    const [fileName, setFileName] = React.useState(\"Drag 'n' drop image, or click to browse \");\n    const [imageFile, setImageFile] = React.useState(null);\n    const history = useHistory();\n\n    const onDrop = useCallback(acceptedFiles => {\n        const file = acceptedFiles[0];\n        let formData = new FormData();\n        setFileName(file.path + \" \");\n        formData.append(\"file\",file);\n        setImageFile(formData);\n        removeImage();\n    }, []);\n\n    function onSubmit(evt) {\n        evt.preventDefault();\n\n        if (imageFile === null && (evt.target.text.value !== \"\" || evt.target.url.value !== \"\")) {\n            fetch(\"/post/insertPost\",{\n                method: 'POST',\n                credentials: \"include\",\n                headers: {\n                    'text': evt.target.text.value,\n                    'imageUrl': evt.target.url.value\n                }\n            })\n                .then(response => response.json())\n                .then((data) => {\n                    document.getElementById(\"resetButton\").click();\n                    props.closeModal();\n                    history.push(\"/profile\");\n                })\n                .then(() => {\n                    history.push(\"/\");\n                })\n                .catch((error) => {\n                    console.error('Error:', error);\n            });\n        }\n        else if (imageFile !== null) {\n            axios.post(\n                \"/post/insertPostWithFile\",\n                imageFile,\n                {\n                    headers:{\n                        \"Content-Type\":\"multipart/form-data\",\n                        'text': evt.target.text.value\n                    }\n                }\n            )\n                .then(() => {\n                    document.getElementById(\"resetButton\").click();\n                    props.closeModal();\n                    history.push(\"/profile\");\n                })\n                .then(() => {\n                    history.push(\"/\");\n                })\n                .catch(err=>{\n                console.log(err);\n            });\n        }\n        else {\n            alert(\"Post cannot be empty\");\n        }\n    }\n\n    const {getRootProps, getInputProps, isDragActive} = useDropzone({onDrop});\n\n    let removeButtonStyle = {\n        display: buttonDisplay\n    }\n\n    function checkImage(imageSrc) {\n        let img = new Image();\n        img.onload = function () {\n            console.log(\"Exists\");\n        };\n        img.onerror = function () {\n            console.log(\"Does not Exist\");\n        };\n        img.src = imageSrc;\n    }\n\n    function findUrl(evt) {\n        if (regex.test(evt.target.value)) {\n            setImgUrl(evt.target.value);\n            document.getElementById(\"url\").value = evt.target.value;\n            evt.target.value = \"\";\n            setButtonDisplay(\"inline\");\n            resetForm();\n        }\n    }\n\n    function removeImage() {\n        setImgUrl(\"\");\n        setButtonDisplay(\"none\");\n        document.getElementById(\"url\").value = \"\";\n    }\n\n    function resetForm() {\n        setFileName(\"Drag 'n' drop image, or click to browse \");\n        setImageFile(null);\n    }\n\n    return (\n        <div className=\"my-2\">\n            <img src={imgUrl} alt=\"\" height=\"120px\" className=\"m-1\"/>\n            <button onClick={removeImage} style={removeButtonStyle} className=\"btn btn-white\">x</button>\n            <form onSubmit={onSubmit}>\n                <div className=\"form-group\">\n                    <textarea className=\"form-control\" id=\"exampleInputEmail1\" aria-describedby=\"freeText\"\n                              placeholder=\"What are you thinking?\" onChange={findUrl} name=\"text\" maxLength=\"250\" rows=\"5\"></textarea>\n                        <small id=\"freeText\" className=\"form-text text-muted\">Only visible to your connections.</small>\n                    <input type=\"hidden\" id=\"url\" name=\"url\"/>\n                </div>\n                <div {...getRootProps()}>\n                    <input {...getInputProps()} />\n                    {\n                        isDragActive ?\n                            <p>Drop the image here ...</p> :\n                            <p>{fileName}<i className=\"far fa-file-image\"></i></p>\n                    }\n                </div>\n                <input type=\"reset\" className=\"btn btn-light mr-2\" value=\"Reset Form\" onClick={resetForm} id=\"resetButton\"/>\n                <button type=\"submit\" className=\"btn btn-primary\">Post</button>\n            </form>\n        </div>\n    );\n}\n\nexport default PostForm;"]},"metadata":{},"sourceType":"module"}